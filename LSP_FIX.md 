# Grove ↔ Grim Fix Tracker *(updated 2025-10-07)*

## Issue 1 – Syntax highlighting falls back to defaults

### Current status
- Grove ships a working highlight engine and 14 language grammars (tree-sitter 0.25.10 / ABI 15).
- Grim now exposes live rope, cursor, and selection data to plugins via the PluginAPI bridge (Oct 7 updates in `runtime/plugin_api.zig` & `ui-tui/simple_tui.zig`).
- Highlighting still degrades to fallback colors because Grim is not yet loading Grove’s `.scm` queries or mapping capture names to the theme registry.

### Next steps
1. Load and cache highlight queries from `third_party/grove-queries` for each registered language.
2. Execute `grove.Highlight.collectHighlights()` against the active buffer (use new buffer ids/events to keep caches fresh).
3. Translate capture names (e.g. `@keyword.operator`) into `syntax.HighlightType` values and wire them through the theme registry so SimpleTUI renders the correct style.
4. Add regression coverage (extend `tests/plugin_theme_registration.zig` or create a dedicated test) that asserts real highlight spans for Ghostlang, TOML, YAML, and C.

## Issue 2 – LSP client/server lifecycle still partial

### Current status
- Ghostls wiring (spawn, initialize, hover, goto-definition) is working; see `LSP_INTEGRATION_COMPLETE.md` for the full checklist.
- SimpleTUI now emits buffer open/save/close events and maintains dynamic buffer ids, so document sync can key off real ids.
- Missing pieces: JSON-RPC response loop, document snapshot tracking, didOpen/didChange notifications, and UI handling of hover/definition payloads.

### Next steps
1. Implement a non-blocking JSON-RPC reader in `lsp/client.zig` that feeds responses into a dispatch queue.
2. Maintain per-buffer snapshots keyed by the new buffer id and push didOpen/didChange/didSave notifications whenever SimpleTUI reports edits.
3. Replace the hover placeholder in SimpleTUI with real ghostls data and wire goto-definition navigation.
4. Extend `test_ghostls.zig` (or add a new integration test) to simulate open/change/save flows and assert that ghostls receives the notifications and responds as expected.

## Cross-cutting follow-up
- Keep buffer lifecycle events, PluginAPI bridge tests, and upcoming UI hooks in sync.
- Update developer docs (`docs/NAVIGATION.md`, `docs/THEME_FFI.md`) once highlight wiring lands.
- Re-run Grove performance goals (<5 ms incremental latency) after highlights + LSP dispatch are in place.

## References
- `ui-tui/simple_tui.zig` – buffer bridge, lifecycle events
- `runtime/plugin_api.zig` – PluginAPI editor bridge
- `lsp/` – client/server plumbing
- `third_party/grove-queries/` – Tree-sitter highlight queries from Grove
- `LATEST_GROVE.md`, `LSP_INTEGRATION_COMPLETE.md` – upstream context

